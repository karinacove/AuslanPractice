// script.js

const startButton = document.getElementById("start-button");
const signinScreen = document.getElementById("signin-screen");
const gameScreen = document.getElementById("game-screen");
const letterDisplay = document.getElementById("letter-display");
const wordInput = document.getElementById("word-input");
const againButton = document.getElementById("again-button");
const speedSlider = document.getElementById("speed-slider");
const timerDisplay = document.getElementById("timer");
const scoreDisplay = document.getElementById("score");
const submitWord = document.getElementById("submit-word");

let studentName = "";
let studentClass = "";
let gameMode = "";
let currentWord = "";
let currentIndex = 0;
let interval = 1000;
let correctWords = [];
let incorrectWords = [];
let score = 0;
let timer = null;
let timeLeft = 120;
let currentLevel = 3;
let levelUpCorrect = 0;

const wordLists = {
  3: ["cat", "dog", "mat", "rat", "leg"],
  4: ["gold", "hair", "chin"],
  5: ["silver", "ankle"],
  6: [],
  7: [],
  8: [],
  9: [],
  10: []
};

function getRandomWord(length) {
  const list = wordLists[length];
  return list[Math.floor(Math.random() * list.length)];
}

function displayWord(word) {
  letterDisplay.textContent = "";
  currentIndex = 0;
  const letters = word.split("");

  const intervalId = setInterval(() => {
    if (currentIndex < letters.length) {
      letterDisplay.textContent = letters[currentIndex];
      currentIndex++;
    } else {
      clearInterval(intervalId);
    }
  }, interval);
}

function resetGame() {
  currentWord = "";
  correctWords = [];
  incorrectWords = [];
  score = 0;
  scoreDisplay.textContent = "Score: 0";
  timeLeft = 120;
}

function startGame() {
  studentName = document.getElementById("student-name").value;
  studentClass = document.getElementById("student-class").value;
  gameMode = document.getElementById("game-mode").value;
  interval = parseInt(speedSlider.value);

  if (!studentName || !studentClass) return alert("Please fill out all fields.");

  signinScreen.style.display = "none";
  gameScreen.style.display = "block";
  resetGame();

  if (gameMode === "timed") startTimedGame();
  else startLevelUpGame();
}

function startTimedGame() {
  pickNewWord(3);
  timer = setInterval(() => {
    timeLeft--;
    timerDisplay.textContent = `Time: ${timeLeft}`;
    if (timeLeft <= 0) {
      clearInterval(timer);
      endGame();
    }
  }, 1000);
}

function startLevelUpGame() {
  currentLevel = 3;
  levelUpCorrect = 0;
  pickNewWord(currentLevel);
}

function pickNewWord(length) {
  currentWord = getRandomWord(length);
  displayWord(currentWord);
  wordInput.value = "";
  wordInput.focus();
}

function checkWord() {
  const guess = wordInput.value.trim().toLowerCase();
  if (guess === currentWord) {
    score++;
    correctWords.push(currentWord);
    scoreDisplay.textContent = `Score: ${score}`;
    if (gameMode === "levelup") {
      levelUpCorrect++;
      if (levelUpCorrect >= 10 && currentLevel < 10) {
        currentLevel++;
        levelUpCorrect = 0;
      }
      pickNewWord(currentLevel);
    } else {
      pickNewWord(3);
    }
  } else {
    incorrectWords.push(currentWord);
    wordInput.value = "";
    wordInput.focus();
  }
}

function endGame() {
  const form = document.createElement("form");
  form.method = "POST";
  form.action = "https://docs.google.com/forms/d/e/1FAIpQLSfOFWu8FcUR3bOwg0mo_3Kb2O7p4m0TLvfUpZjx0zdzqKac4Q/formResponse";
  form.target = "_blank";

  const fields = {
    "entry.423692452": studentName,
    "entry.1307864012": studentClass,
    "entry.468778567": gameMode,
    "entry.1083699348": score,
    "entry.746947164": correctWords.join(", "),
    "entry.1534005804": incorrectWords.join(", "),
    "entry.1974555000": speedSlider.value
  };

  for (let name in fields) {
    const input = document.createElement("input");
    input.type = "hidden";
    input.name = name;
    input.value = fields[name];
    form.appendChild(input);
  }

  document.body.appendChild(form);
  form.submit();
  document.body.removeChild(form);
  alert("Thanks for playing!");
  location.reload();
}

startButton.addEventListener("click", startGame);
submitWord.addEventListener("click", checkWord);
againButton.addEventListener("click", () => displayWord(currentWord));
speedSlider.addEventListener("input", () => {
  interval = parseInt(speedSlider.value);
});
wordInput.addEventListener("keydown", (e) => {
  if (e.key === "Enter") {
    e.preventDefault();
    checkWord();
  }
});
